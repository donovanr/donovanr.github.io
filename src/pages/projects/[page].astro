---
import Pagination from "@/components/ui/Pagination.astro";
import Layout from "@/layouts/Layout.astro";
import { template } from "@/settings";
import { getCollection } from "astro:content";

export async function getStaticPaths({
  paginate,
}): Promise<Astro.getStaticPathsResult> {
  const projectEntries = await getCollection("projects");

  const projects = projectEntries
    .map((project) => ({
      title: project.data.title,
      description: project.data.description,
      img: project.data.img,
      importance: project.data.importance || 999,
      category: project.data.category || "other",
      slug: `${template.base}/projects/${project.id}`,
    }))
    .sort((a, b) => a.importance - b.importance);

  return paginate(projects, {
    pageSize: 20,
  });
}
const { page } = Astro.props;
---

<Layout title="Projects">
  <div>
    <h1 class="text-3xl font-bold mb-8">Research Projects</h1>
    <div class="grid gap-8">
      {
        page.data.map((project) => (
          <article class="card bg-base-200 transition-all hover:shadow-lg">
            <div class="card-body">
              <div class="flex flex-col md:flex-row gap-6">
                {project.img && (
                  <div class="md:w-1/3">
                    <img
                      src={project.img}
                      alt={project.title}
                      class="w-full h-48 object-cover rounded-lg"
                    />
                  </div>
                )}
                <div class={project.img ? "md:w-2/3" : "w-full"}>
                  <h2 class="card-title text-xl mb-2">
                    <a href={project.slug} class="hover:text-accent">
                      {project.title}
                    </a>
                  </h2>
                  <p class="mt-4">{project.description}</p>
                  <div class="card-actions justify-end mt-4">
                    <a
                      href={project.slug}
                      class="btn btn-sm btn-secondary text-secondary-content"
                    >
                      Learn More
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </article>
        ))
      }
    </div>

    <div class="flex justify-center mt-8">
      <Pagination page={page} />
    </div>
  </div>
</Layout>
